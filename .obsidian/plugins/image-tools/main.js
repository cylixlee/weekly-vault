/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var E=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var V=(o,e)=>{for(var s in e)E(o,s,{get:e[s],enumerable:!0})},A=(o,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of U(e))!T.call(o,n)&&n!==s&&E(o,n,{get:()=>e[n],enumerable:!(t=b(e,n))||t.enumerable});return o};var z=o=>A(E({},"__esModule",{value:!0}),o);var P={};V(P,{default:()=>N});module.exports=z(P);var c=require("@codemirror/view"),C=require("obsidian");var p=class{constructor(e){e.startsWith("![[")?this.parseLocalImage(e):this.parseUrlImage(e)}parseLocalImage(e){this.type="local";let s=e.slice(3,e.length-2).split("|");if(this.img=s[0],s.length==3){this.align=s[1],this.width=s[2];return}s.length==2&&(s[1]=="left"||s[1]=="center"||s[1]=="right"?this.align=s[1]:this.width=s[1])}parseUrlImage(e){this.type="url";let t=e.split("]")[0].split("[")[1].split("|");this.name=t[0],t.length==3&&(this.align=t[1],this.width=t[2]),t.length==2&&(t[1]=="left"||t[1]=="center"||t[1]=="right"?this.align=t[1]:this.width=t[1]),this.img=e.split("(")[1].split(")")[0]}getImageText(){return this.type==="local"?this.getLocalImageText():this.getUrlImageText()}getLocalImageText(){let e=this.img;return this.align!==void 0&&(e+="|"+this.align),this.width!==void 0&&(e+="|"+this.width),`![[${e}]]`}getUrlImageText(){let e=this.name;return this.align!==void 0&&(e+="|"+this.align),this.width!==void 0&&(e+="|"+this.width),console.log(this.img),`![${e}](${this.img})`}setWidth(e){this.width=e}setAlign(e){this.align=e}};var l=class{constructor(e){this.text=e}getImageIndexes(e){return console.log("getImageIndexes",e),this.isLocalImage(e)?(console.log("isLocalImage"),this.getLocalImageIndexes(e)):this.isUrlImage(e)?(console.log("isUrlImage"),this.getUrlImageIndexes(e)):(console.log("[0, 0]"),[0,0])}isLocalImage(e){return this.text.indexOf(`![[${e}`)!==-1}isUrlImage(e){let s=new RegExp(`!\\[.+\\]\\(${e}\\)`);return!!this.text.match(s)}getLocalImageIndexes(e){let s=this.text.indexOf(`![[${e}`),t=s;for(let n=s+1;n<this.text.length;n++)if(this.text[n]==="]"&&this.text[n+1]==="]"){t=n+2;break}return[s,t]}getUrlImageIndexes(e){let s=new RegExp(`!\\[.+\\]\\(${e}\\)`),t=this.text.match(s);return t&&t.index!==void 0?[t.index,t.index+t[0].length]:[0,0]}getImageText(e){console.log("getImageText",e);let[s,t]=this.getImageIndexes(e);return console.log("getImageText",[s,t]),new p(this.text.slice(s,t))}};var y=require("obsidian"),u=class{constructor(){this.alignIconsClassName="align-icons-class-name image-tools-icons-container image-tools-icons-container-right"}update(e){this.viewUpdate=e,this.mdText=new l(e.state.doc.toString());let s=e.view.dom.getElementsByClassName("image-embed");Array.from(s).forEach(t=>{let n=t.children[0],a=Array.from(t.children).map(i=>i.className);if(t.children[0].tagName==="IMG"&&!a.includes(this.alignIconsClassName)&&this.addAlignIcons(n),!t.className.includes("images-tools-text-align-")){let i="images-tools-text-align-"+this.mdText.getImageText(n.parentNode.getAttribute("src")).align;t.classList.add(i)}})}addAlignIcons(e){let s=e.parentNode,t=document.createElement("div");t.className=this.alignIconsClassName,t.append(this.createIconElement("align-left",()=>{this.setNewAlignForImage(e,"left"),s.classList.remove("images-tools-text-align-right"),s.classList.remove("images-tools-text-align-center"),s.classList.add("images-tools-text-align-left")})),t.append(this.createIconElement("align-center",()=>{this.setNewAlignForImage(e,"center"),s.classList.remove("images-tools-text-align-right"),s.classList.remove("images-tools-text-align-left"),s.classList.add("images-tools-text-align-center")})),t.append(this.createIconElement("align-right",()=>{this.setNewAlignForImage(e,"right"),s.classList.remove("images-tools-text-align-center"),s.classList.remove("images-tools-text-align-left"),s.classList.add("images-tools-text-align-right")})),s.append(t)}createIconElement(e,s){let t=document.createElement("div");return(0,y.setIcon)(t,e),t.className="image-tools-icon",t.addEventListener("click",s),t}setNewAlignForImage(e,s){let t=e.parentNode.getAttribute("src"),n=this.mdText.getImageText(t),[a,i]=this.mdText.getImageIndexes(t);n.setAlign(s);let m=this.viewUpdate.state.update({changes:{from:a,to:i,insert:n.getImageText()}});this.viewUpdate.view.dispatch(m)}};var f=class{constructor(){this.rightResizeIconClassName="right-resize-icon-class-name image-tools-resize-item image-tools-resize-item-right";this.leftResizeIconClassName="left-resize-icon-class-name image-tools-resize-item image-tools-resize-item-left"}update(e){this.viewUpdate=e,this.mdText=new l(e.state.doc.toString());let s=e.view.dom.getElementsByClassName("image-embed");Array.from(s).forEach(t=>{let n=Array.from(t.children).map(a=>a.className);t.children[0].tagName==="IMG"&&!n.includes(this.rightResizeIconClassName)&&this.addRightResizeIcon(t.children[0])}),Array.from(s).forEach(t=>{let n=Array.from(t.children).map(a=>a.className);t.children[0].tagName==="IMG"&&!n.includes(this.leftResizeIconClassName)&&this.addLeftResizeIcon(t.children[0])})}addRightResizeIcon(e){var t;let s=document.createElement("div");s.className=this.rightResizeIconClassName,s.addEventListener("mousedown",n=>{var d;let a=n.clientX,i=0;document.defaultView&&(i=parseInt((d=document==null?void 0:document.defaultView)==null?void 0:d.getComputedStyle(e).width,10));let m=g=>{let h=i+g.clientX-a;this.setNewWidthForImage(e,h),e.setAttribute("width",`${h}px`)},r=g=>{document.documentElement.removeEventListener("mousemove",m,!1),document.documentElement.removeEventListener("mouseup",r,!1)};document.documentElement.addEventListener("mousemove",m,!1),document.documentElement.addEventListener("mouseup",r,!1)}),(t=e.parentNode)==null||t.append(s)}addLeftResizeIcon(e){var t;let s=document.createElement("div");s.className=this.leftResizeIconClassName,s.addEventListener("mousedown",n=>{var d;let a=n.clientX,i=0;document.defaultView&&(i=parseInt((d=document==null?void 0:document.defaultView)==null?void 0:d.getComputedStyle(e).width,10));let m=g=>{let h=i-g.clientX+a;this.setNewWidthForImage(e,h),e.setAttribute("width",`${h}px`)},r=g=>{document.documentElement.removeEventListener("mousemove",m,!1),document.documentElement.removeEventListener("mouseup",r,!1)};document.documentElement.addEventListener("mousemove",m,!1),document.documentElement.addEventListener("mouseup",r,!1)}),(t=e.parentNode)==null||t.append(s)}setNewWidthForImage(e,s){let t=e.parentNode.getAttribute("src"),n=this.mdText.getImageText(t),[a,i]=this.mdText.getImageIndexes(t);n.setWidth(s.toString());let m=this.viewUpdate.state.update({changes:{from:a,to:i,insert:n.getImageText()}});this.viewUpdate.view.dispatch(m)}};var v=require("obsidian"),I=class{constructor(){this.zoomIconsClassName="zoom-icons-class-name image-tools-icons-container image-tools-icons-container-left"}update(e){this.viewUpdate=e;let s=e.view.dom.getElementsByClassName("image-embed");Array.from(s).forEach(t=>{let n=Array.from(t.children).map(a=>a.className);t.children[0].tagName==="IMG"&&!n.includes(this.zoomIconsClassName)&&this.addZoomIcon(t.children[0])})}addZoomIcon(e){var n;let s=e.parentNode,t=document.createElement("div");t.className=this.zoomIconsClassName,t.append(this.createIconElement(()=>this.openImageDialog(e,s))),(n=e.parentNode)==null||n.append(t)}createIconElement(e){let s=document.createElement("div");return(0,v.setIcon)(s,"zoom-in"),s.className="image-tools-icon",s.addEventListener("click",e),s}openImageDialog(e,s){let t=document.createElement("dialog");t.className="image-tools-image-zoom-container",t.addEventListener("click",t.remove);let n=document.createElement("img");n.src=e.src,n.className="image-tools-zoom-image",t.append(n),s.parentNode.parentNode.append(t),t.showModal()}};var L=require("obsidian"),w=class{constructor(){this.copyImageClassName="copy-icon-container image-tools-icons-container image-tools-copy-icon"}update(e){this.viewUpdate=e;let s=e.view.dom.getElementsByClassName("image-embed");Array.from(s).forEach(t=>{let n=Array.from(t.children).map(a=>a.className);t.children[0].tagName==="IMG"&&!n.includes(this.copyImageClassName)&&this.addCopyImageIcon(t.children[0])})}addCopyImageIcon(e){var t;let s=document.createElement("div");s.className=this.copyImageClassName,s.append(this.createIconElement(()=>this.copyImage(e.src))),(t=e.parentNode)==null||t.append(s)}createIconElement(e){let s=document.createElement("div");return(0,L.setIcon)(s,"copy"),s.className="image-tools-icon",s.addEventListener("click",e),s}async copyImage(e){let t=await(await fetch(e)).blob();t=await this.convertBlobToPng(t),await this.copyBlobToClipboard(t)}async copyBlobToClipboard(e){let s={[e.type]:e},t=new ClipboardItem(s);await navigator.clipboard.write([t])}async convertBlobToPng(e){let s=URL.createObjectURL(e),t=await this.createImageElement(s);return await this.getBlobFromImageElement(t)}async createImageElement(e){return new Promise(function(s,t){let n=document.createElement("img");n.crossOrigin="anonymous",n.src=e,n.onload=function(a){let i=a.target;s(i)},n.onabort=t,n.onerror=t})}async getBlobFromImageElement(e){return new Promise(function(s,t){let n=document.createElement("canvas"),a=n.getContext("2d");if(a){let{width:i,height:m}=e;n.width=i,n.height=m,a.drawImage(e,0,0,i,m),n.toBlob(function(r){r?s(r):t("Cannot get blob from image element")},"image/png",1)}})}};var x=class{constructor(){this.flag=!1}update(e){if(this.flag)return;let t=e.view.dom.getElementsByClassName("cm-content")[0].getElementsByTagName("img");Array.from(t).forEach(n=>{if(n.parentNode.className.includes("image-embed")||n.parentNode.tagName==="DIALOG")return;let a=document.createElement("div");a.className="internal-embed media-embed image-embed is-loaded image-tools-image-url",a.setAttribute("src",n.src),n.parentNode.insertAfter(a,n),a.append(n)})}};var N=class extends C.Plugin{onload(){this.registerEditorExtension([c.ViewPlugin.fromClass(x),c.ViewPlugin.fromClass(u),c.ViewPlugin.fromClass(I),c.ViewPlugin.fromClass(f),c.ViewPlugin.fromClass(w)])}};

/* nosourcemap */